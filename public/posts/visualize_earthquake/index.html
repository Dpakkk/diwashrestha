<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Visualizing Earthquake - Diwashrestha</title><meta name=Description content="Diwash Shrestha Personal Website"><meta property="og:title" content="Visualizing Earthquake"><meta property="og:description" content="According to USGS:
 An earthquake is caused by a sudden slip on a fault. The tectonic plates are always slowly moving, but they get stuck at their edges due to friction. When the stress on the edge overcomes the friction, there is an earthquake that releases energy in waves that travel through the earth&rsquo;s crust and cause the shaking that we feel.
 Earthquake size can be very weak which can’t be felt to those which can destroy cities."><meta property="og:type" content="article"><meta property="og:url" content="http://diwashrestha.com.np/posts/visualize_earthquake/"><meta property="og:image" content="http://diwashrestha.com.np/images/bloglogo.png"><meta property="article:published_time" content="2019-07-19T23:19:18+05:45"><meta property="article:modified_time" content="2019-07-19T23:19:18+05:45"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://diwashrestha.com.np/images/bloglogo.png"><meta name=twitter:title content="Visualizing Earthquake"><meta name=twitter:description content="According to USGS:
 An earthquake is caused by a sudden slip on a fault. The tectonic plates are always slowly moving, but they get stuck at their edges due to friction. When the stress on the edge overcomes the friction, there is an earthquake that releases energy in waves that travel through the earth&rsquo;s crust and cause the shaking that we feel.
 Earthquake size can be very weak which can’t be felt to those which can destroy cities."><meta name=application-name content="diwashrestha"><meta name=apple-mobile-web-app-title content="diwashrestha"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://diwashrestha.com.np/posts/visualize_earthquake/><link rel=prev href=http://diwashrestha.com.np/posts/global-azure-bootcamp-2019/><link rel=next href=http://diwashrestha.com.np/posts/tidytuesday_videogame/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Visualizing Earthquake","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/diwashrestha.com.np\/posts\/visualize_earthquake\/"},"genre":"posts","wordcount":664,"url":"http:\/\/diwashrestha.com.np\/posts\/visualize_earthquake\/","datePublished":"2019-07-19T23:19:18+05:45","dateModified":"2019-07-19T23:19:18+05:45","description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':(''==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:''==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Diwashrestha>DiwAsh ShresthA</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/me/ title="About Me">About Me </a><a class=menu-item href=/projects/>Projects </a><a class=menu-item href=/programstalks/>Program & Talks </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Diwashrestha>DiwAsh ShresthA</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/me/ title="About Me">About Me</a><a class=menu-item href=/projects/>Projects</a><a class=menu-item href=/programstalks/>Program & Talks</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><article class="page single"><h1 class="single-title animated flipInX">Visualizing Earthquake</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i></a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="Friday, Jul 19, 2019">Friday, Jul 19, 2019</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;about 664 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;4 min&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading/normal.min.svg data-src=/images/visual_earthquake/preview.png data-srcset="/images/visual_earthquake/preview.png, /images/visual_earthquake/preview.png 1.5x, /images/visual_earthquake/preview.png 2x" data-sizes=auto alt=/images/visual_earthquake/preview.png title=/images/visual_earthquake/preview.png></div><div class=content id=content><p>According to <a href=https://www.usgs.gov/about/about-us/who-we-are target=_blank rel="noopener noreffer">USGS</a>:</p><blockquote><p>An earthquake is caused by a sudden slip on a fault. The tectonic plates are always slowly moving, but they get stuck at their edges due to friction. When the stress on the edge overcomes the friction, there is an earthquake that releases energy in waves that travel through the earth&rsquo;s crust and cause the shaking that we feel.</p></blockquote><p>Earthquake size can be very weak which can’t be felt to those which can destroy cities. The size of the earthquake is determind by the magnitude of the earthquake in seismic scale.</p><a class=lightgallery href=/images/visual_earthquake/earthquake.jpg title=/images/visual_earthquake/earthquake.jpg data-thumbnail=/images/visual_earthquake/earthquake.jpg><img class=lazyload src=/svg/loading/normal.min.svg data-src=/images/visual_earthquake/earthquake.jpg data-srcset="/images/visual_earthquake/earthquake.jpg, /images/visual_earthquake/earthquake.jpg 1.5x, /images/visual_earthquake/earthquake.jpg 2x" data-sizes=auto alt=/images/visual_earthquake/earthquake.jpg></a><p>In this blog, We will create an interactive visualization of the 20 largest earthquakes in the world. We will use the data from <a href=https://www.usgs.gov/natural-hazards/earthquake-hazards/earthquakes target=_blank rel="noopener noreffer">Earthquake.usgs.gov</a>, US government website about geological research. The data is extracted using rvest package(web scraping package). We will use <a href=http://jkunst.com/highcharter/index.html target=_blank rel="noopener noreffer">highcharter</a> package to create the visualization.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-R data-lang=R><span class=c1># loading library</span>
<span class=nf>library</span><span class=p>(</span><span class=n>rvest</span><span class=p>)</span>
<span class=nf>library</span><span class=p>(</span><span class=n>tidyverse</span><span class=p>)</span>
<span class=nf>library</span><span class=p>(</span><span class=n>highcharter</span><span class=p>)</span>
<span class=nf>library</span><span class=p>(</span><span class=n>geojsonio</span><span class=p>)</span>
<span class=nf>library</span><span class=p>(</span><span class=n>geojsonlint</span><span class=p>)</span>
<span class=nf>library</span><span class=p>(</span><span class=n>sp</span><span class=p>)</span>
<span class=nf>library</span><span class=p>(</span><span class=n>jsonlite</span><span class=p>)</span>

<span class=c1># loading data</span>
<span class=c1># webscraping using rvest </span>
<span class=n>url</span> <span class=o>&lt;-</span> <span class=s>&#34;https://earthquake.usgs.gov/earthquakes/browse/largest-world.php&#34;</span>
<span class=n>earthquake</span> <span class=o>&lt;-</span> <span class=n>url</span> <span class=o>%&gt;%</span>
  <span class=nf>html</span><span class=p>()</span> <span class=o>%&gt;%</span>
  <span class=nf>html_nodes</span><span class=p>(</span><span class=n>xpath</span> <span class=o>=</span> <span class=s>&#34;/html/body/main/div/div/table&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span>
  <span class=nf>html_table</span><span class=p>()</span>
<span class=n>earthquake</span> <span class=o>&lt;-</span> <span class=n>earthquake[[1]]</span>

<span class=n>earthquake</span> <span class=o>&lt;-</span> <span class=nf>rename</span><span class=p>(</span><span class=n>earthquake</span><span class=p>,</span> <span class=n>lat</span> <span class=o>=</span> <span class=n>Latitude</span><span class=p>,</span> <span class=n>lon</span> <span class=o>=</span> <span class=n>Longitude</span><span class=p>)</span>
<span class=n>earthquake</span> <span class=o>&lt;-</span> <span class=nf>select</span><span class=p>(</span><span class=n>earthquake</span><span class=p>,</span> <span class=o>-</span><span class=s>&#34;&#34;</span><span class=p>)</span>

<span class=c1># convert gis cordinates to longitude and latitudes</span>
<span class=n>earthquake</span><span class=o>$</span><span class=n>lat</span> <span class=o>&lt;-</span> <span class=nf>as.numeric</span><span class=p>(</span><span class=nf>char2dms</span><span class=p>(</span><span class=n>earthquake</span><span class=o>$</span><span class=n>lat</span><span class=p>,</span> <span class=n>chd</span> <span class=o>=</span> <span class=s>&#34;°&#34;</span><span class=p>))</span>
<span class=n>earthquake</span><span class=o>$</span><span class=n>lon</span> <span class=o>&lt;-</span> <span class=nf>as.numeric</span><span class=p>(</span><span class=nf>char2dms</span><span class=p>(</span><span class=n>earthquake</span><span class=o>$</span><span class=n>lon</span><span class=p>,</span> <span class=n>chd</span> <span class=o>=</span> <span class=s>&#34;°&#34;</span><span class=p>))</span>
</code></pre></td></tr></table></div></div><p>Here is the look of data that i will use to create the visualization of the earthquake.It has Name of the earthquake,magnitude,location,time,date,logitude and latitude of the earthquake.</p><table><thead><tr><th>Mag</th><th>Location</th><th>Alternative Name</th><th>Date (UTC)</th><th>Time (UTC)</th><th>lat</th><th>lon</th><th>References</th></tr></thead><tbody><tr><td>9.5</td><td>Bio-Bio, Chile</td><td>Valdivia Earthquake</td><td>1960-05-22</td><td>19:11</td><td>-38</td><td>-73</td><td>Kanamori & Anderson, 1975</td></tr><tr><td>9.2</td><td>Southern Alaska</td><td>1964 Great Alaska Earthquake, Prince William Sound Earthquake, Good Friday Earthquake</td><td>1964-03-28</td><td>03:36</td><td>60</td><td>-147</td><td>Kanamori & Anderson, 1975</td></tr><tr><td>9.1</td><td>Off the West Coast of Northern Sumatra</td><td>Sumatra-Andaman Islands Earthquake, 2004 Sumatra Earthquake and Tsunami, Indian Ocean Earthquake</td><td>2004-12-26</td><td>00:58</td><td>3</td><td>95</td><td>Duputel et al., 2012</td></tr><tr><td>9.1</td><td>Near the East Coast of Honshu, Japan</td><td>Tohoku Earthquake</td><td>2011-03-11</td><td>05:46</td><td>38</td><td>142</td><td>Duputel et al., 2012</td></tr><tr><td>9.0</td><td>Off the East Coast of the Kamchatka Peninsula, Russia</td><td>Kamchatka, Russia</td><td>1952-11-04</td><td>16:58</td><td>52</td><td>159</td><td>Kanamori, 1976</td></tr><tr><td>8.8</td><td>Offshore Bio-Bio, Chile</td><td>Maule Earthquake</td><td>2010-02-27</td><td>06:34</td><td>-36</td><td>-72</td><td>Duputel et al., 2012</td></tr></tbody></table><p>In this visualization we will also use data of the tectonic plates of the earth. We will be using geojson of the earthmap and the tectonic to create the map.The data about the tectonic plates and the world map is taken from <a href=http://jkunst.com/highcharter/highmaps.html target=_blank rel="noopener noreffer">highcharter</a> example.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-R data-lang=R><span class=n>getContent</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>(</span><span class=n>url</span><span class=p>)</span> <span class=p>{</span>
  <span class=nf>library</span><span class=p>(</span><span class=n>httr</span><span class=p>)</span>
  <span class=nf>content</span><span class=p>(</span><span class=nf>GET</span><span class=p>(</span><span class=n>url</span><span class=p>))</span>
<span class=p>}</span>

<span class=n>world</span> <span class=o>&lt;-</span> <span class=nf>getContent</span><span class=p>(</span><span class=s>&#34;https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json&#34;</span><span class=p>)</span>
<span class=c1># is text</span>
<span class=n>world</span> <span class=o>&lt;-</span> <span class=n>jsonlite</span><span class=o>::</span><span class=nf>fromJSON</span><span class=p>(</span><span class=n>world</span><span class=p>,</span> <span class=n>simplifyVector</span> <span class=o>=</span> <span class=kc>FALSE</span><span class=p>)</span>

<span class=n>plates</span> <span class=o>&lt;-</span> <span class=nf>getContent</span><span class=p>(</span><span class=s>&#34;http://cedeusdata.geosteiniger.cl/geoserver/wfs?srsName=EPSG%3A4326&amp;typename=geonode%3Amundo_limites_placas&amp;outputFormat=json&amp;version=1.0.0&amp;service=WFS&amp;request=GetFeature&#34;</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><p>The earthquake dataframe also need to be changed to geojson which is done using the geojson_json() from geojsonio package.</p><p>Finally we will use the follwing code to create interactive visualization of the 20 largest earthquake in the world.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-R data-lang=R><span class=nf>highchart</span><span class=p>(</span><span class=n>type</span> <span class=o>=</span> <span class=s>&#34;map&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span>
  <span class=nf>hc_chart</span><span class=p>(</span><span class=n>backgroundColor</span> <span class=o>=</span> <span class=s>&#34;#ccc&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span>
  <span class=nf>hc_add_series</span><span class=p>(</span>
    <span class=n>mapData</span> <span class=o>=</span> <span class=n>world</span><span class=p>,</span> <span class=n>showInLegend</span> <span class=o>=</span> <span class=kc>FALSE</span><span class=p>,</span> <span class=n>nullColor</span> <span class=o>=</span> <span class=s>&#34;#eee&#34;</span><span class=p>,</span>
    <span class=n>borderWidth</span> <span class=o>=</span> <span class=m>0</span>
  <span class=p>)</span> <span class=o>%&gt;%</span>
  <span class=nf>hc_add_series</span><span class=p>(</span>
    <span class=n>data</span> <span class=o>=</span> <span class=n>plates</span><span class=p>,</span> <span class=n>type</span> <span class=o>=</span> <span class=s>&#34;mapline&#34;</span><span class=p>,</span> <span class=n>lineWidth</span> <span class=o>=</span> <span class=m>1</span><span class=p>,</span> <span class=n>zIndex</span> <span class=o>=</span> <span class=m>-1</span><span class=p>,</span> <span class=n>geojson</span> <span class=o>=</span> <span class=kc>TRUE</span><span class=p>,</span>
    <span class=n>color</span> <span class=o>=</span> <span class=s>&#34;blue&#34;</span><span class=p>,</span> <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;Plates&#34;</span><span class=p>,</span>
    <span class=n>tooltip</span> <span class=o>=</span> <span class=nf>list</span><span class=p>(</span><span class=n>pointFormat</span> <span class=o>=</span> <span class=s>&#34;{point.properties.TIPO}&#34;</span><span class=p>)</span>
  <span class=p>)</span> <span class=o>%&gt;%</span>
  <span class=nf>hc_add_series</span><span class=p>(</span><span class=n>type</span> <span class=o>=</span> <span class=s>&#34;mappoint&#34;</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>earthquake_geojson</span><span class=p>,</span>
  <span class=n>color</span> <span class=o>=</span> <span class=nf>hex_to_rgba</span><span class=p>(</span><span class=s>&#34;#ff4444&#34;</span><span class=p>,</span> <span class=m>0.6</span><span class=p>),</span> <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;Earthquake&#34;</span><span class=p>,</span> 
  <span class=n>size</span> <span class=o>=</span> <span class=s>&#34;110%&#34;</span><span class=p>,</span> <span class=n>tooltip</span> <span class=o>=</span> <span class=nf>list</span><span class=p>(</span><span class=n>pointFormat</span> <span class=o>=</span> <span class=s>&#34;Location : {point.properties.Location} &lt;br&gt;
</span><span class=s>                Magnitude : {point.properties.Mag} &lt;br&gt;
</span><span class=s>                Date : {point.properties.Date (UTC)},
</span><span class=s>                {point.properties.Time (UTC)}&#34;</span><span class=p>))</span> <span class=o>%&gt;%</span>
  <span class=nf>hc_tooltip</span><span class=p>(</span>
    <span class=n>backgroundColor</span> <span class=o>=</span> <span class=s>&#34;#f2e3b8&#34;</span><span class=p>,</span>
    <span class=n>borderWidth</span> <span class=o>=</span> <span class=m>2</span>
  <span class=p>)</span> <span class=o>%&gt;%</span>
  <span class=nf>hc_title</span><span class=p>(</span><span class=n>text</span> <span class=o>=</span> <span class=s>&#34;20 Largest Earthquakes in the World&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span>
  <span class=nf>hc_mapNavigation</span><span class=p>(</span><span class=n>enabled</span> <span class=o>=</span> <span class=kc>TRUE</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading/small.min.svg data-src=/images/visual_earthquake/earthquake.gif data-srcset="/images/visual_earthquake/earthquake.gif, /images/visual_earthquake/earthquake.gif 1.5x, /images/visual_earthquake/earthquake.gif 2x" data-sizes=auto alt=Earthquake title=Earthquake></p><p>In this visualization we can see almost all of the earthquake occurs on the intersection of two tectonic plates. We can use mouse to hover over the point and get details about the earthquake through tooltips.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>The article was updated on Friday, Jul 19, 2019</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/global-azure-bootcamp-2019/ class=prev rel=prev title="Organized Global Azure Bootcamp 2019"><i class="fas fa-angle-left fa-fw"></i>Organized Global Azure Bootcamp 2019</a>
<a href=/posts/tidytuesday_videogame/ class=next rel=next title=TidyTuesday:VideoGame>TidyTuesday:VideoGame<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.69.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.8"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2017 - 2020</span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp>Diwash Shrestha</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>